var X=Object.defineProperty;var ee=(e,t,r)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var R=(e,t,r)=>ee(e,typeof t!="symbol"?t+"":t,r);import{h as Z,D as te,N as re,F as se,L as ae,G as ne}from"./C5RO-5A5.js";import{b as oe}from"./D6srbyFG.js";import{s as j,t as $,u as C,r as ie,a as w,h as ue}from"./BW6WRhVc.js";const ce=Symbol("is custom element"),de=Symbol("is html");function Re(e){if(Z){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;B(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var a=e.checked;B(e,"checked",null),e.checked=a}}};e.__on_r=r,te(r),oe()}}function B(e,t,r,s){var a=fe(e);Z&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=r)&&(t==="loading"&&(e[ae]=r),r==null?e.removeAttribute(t):typeof r!="string"&&le(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function fe(e){return e.__attributes??(e.__attributes={[ce]:e.nodeName.includes("-"),[de]:e.namespaceURI===re})}var H=new Map;function le(e){var t=H.get(e.nodeName);if(t)return t;H.set(e.nodeName,t=[]);for(var r,s=e,a=Element.prototype;a!==s;){r=ne(s);for(var i in r)r[i].set&&t.push(i);s=se(s)}return t}var U=class extends Error{constructor(e,t){super(t+""),this.status=e,this.value=t}},he=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,pe=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,ye=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,_e=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),K=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(he.test(t)||pe.test(t)||ye.test(t)){let r=new Date(t);if(!Number.isNaN(r.getTime()))return r}return null},ge=e=>{let t=e.charCodeAt(0),r=e.charCodeAt(e.length-1);return t===123&&r===125||t===91&&r===93},we=e=>JSON.parse(e,(t,r)=>K(r)||r),D=e=>{if(!e)return e;if(_e(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=K(e);if(t)return t;if(ge(e))try{return we(e)}catch{}return e},be=e=>{let t=e.data.toString();return t==="null"?null:D(t)},me=class{constructor(e){R(this,"ws");this.url=e,this.ws=new WebSocket(e)}send(e){return Array.isArray(e)?(e.forEach(t=>this.send(t)),this):(this.ws.send(typeof e=="object"?JSON.stringify(e):e.toString()),this)}on(e,t,r){return this.addEventListener(e,t,r)}off(e,t,r){return this.ws.removeEventListener(e,t,r),this}subscribe(e,t){return this.addEventListener("message",e,t)}addEventListener(e,t,r){return this.ws.addEventListener(e,s=>{if(e==="message"){let a=be(s);t({...s,data:a})}else t(s)},r),this}removeEventListener(e,t,r){return this.off(e,t,r),this}close(){return this.ws.close(),this}},ve=["get","post","put","delete","patch","options","head","connect","subscribe"],z=["localhost","127.0.0.1","0.0.0.0"],W=typeof FileList>"u",G=e=>W?e instanceof Blob:e instanceof FileList||e instanceof File,ke=e=>{if(!e)return!1;for(let t in e)if(G(e[t])||Array.isArray(e[t])&&e[t].find(G))return!0;return!1},I=e=>W?e:new Promise(t=>{let r=new FileReader;r.onload=()=>{let s=new File([r.result],e.name,{lastModified:e.lastModified,type:e.type});t(s)},r.readAsArrayBuffer(e)}),v=(e,t,r={},s={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))s=v(a,t,r,s);else{let i=a[0];if(typeof i=="string")s[i.toLowerCase()]=a[1];else for(let[n,d]of i)s[n.toLowerCase()]=d}return s}if(!e)return s;switch(typeof e){case"function":if(e instanceof Headers)return v(e,t,r,s);let a=e(t,r);return a?v(a,t,r,s):s;case"object":if(e instanceof Headers)return e.forEach((i,n)=>{s[n.toLowerCase()]=i}),s;for(let[i,n]of Object.entries(e))s[i.toLowerCase()]=n;return s;default:return s}};async function*Ae(e){let t=e.body;if(!t)return;let r=t.getReader(),s=new TextDecoder;try{for(;;){let{done:a,value:i}=await r.read();if(a)break;let n=s.decode(i);yield D(n)}}finally{r.releaseLock()}}var E=(e,t,r=[],s)=>new Proxy(()=>{},{get(a,i){return E(e,t,i==="index"?r:[...r,i],s)},apply(a,i,[n,d]){if(!n||d||typeof n=="object"&&Object.keys(n).length!==1||ve.includes(r.at(-1))){let T=[...r],b=T.pop(),g="/"+T.join("/"),{fetcher:Y=fetch,headers:x,onRequest:p,onResponse:S,fetch:Q}=t,k=b==="get"||b==="head"||b==="subscribe";x=v(x,g,d);let P=k?n==null?void 0:n.query:d==null?void 0:d.query,M="";if(P){let o=(_,y)=>{M+=(M?"&":"?")+`${encodeURIComponent(_)}=${encodeURIComponent(y)}`};for(let[_,y]of Object.entries(P)){if(Array.isArray(y)){for(let c of y)o(_,c);continue}if(typeof y=="object"){o(_,JSON.stringify(y));continue}o(_,`${y}`)}}if(b==="subscribe"){let o=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||z.find(_=>e.includes(_))?"ws://":"wss://")+g+M;return new me(o)}return(async()=>{var q;let o={method:b==null?void 0:b.toUpperCase(),body:n,...Q,headers:x};o.headers={...x,...v(k?n==null?void 0:n.headers:d==null?void 0:d.headers,g,o)};let _=k&&typeof n=="object"?n.fetch:d==null?void 0:d.fetch;if(o={...o,..._},k&&delete o.body,p){Array.isArray(p)||(p=[p]);for(let f of p){let u=await f(g,o);typeof u=="object"&&(o={...o,...u,headers:{...o.headers,...v(u.headers,g,o)}})}}if(k&&delete o.body,ke(n)){let f=new FormData;for(let[u,h]of Object.entries(o.body)){if(W){f.append(u,h);continue}if(h instanceof File){f.append(u,await I(h));continue}if(h instanceof FileList){for(let m=0;m<h.length;m++)f.append(u,await I(h[m]));continue}if(Array.isArray(h)){for(let m=0;m<h.length;m++){let O=h[m];f.append(u,O instanceof File?await I(O):O)}continue}f.append(u,h)}o.body=f}else typeof n=="object"?(o.headers["content-type"]="application/json",o.body=JSON.stringify(n)):n!=null&&(o.headers["content-type"]="text/plain");if(k&&delete o.body,p){Array.isArray(p)||(p=[p]);for(let f of p){let u=await f(g,o);typeof u=="object"&&(o={...o,...u,headers:{...o.headers,...v(u.headers,g,o)}})}}let y=e+g+M,c=await((s==null?void 0:s.handle(new Request(y,o)))??Y(y,o)),l=null,N=null;if(S){Array.isArray(S)||(S=[S]);for(let f of S)try{let u=await f(c.clone());if(u!=null){l=u;break}}catch(u){u instanceof U?N=u:N=new U(422,u);break}}if(l!==null)return{data:l,error:N,response:c,status:c.status,headers:c.headers};switch((q=c.headers.get("Content-Type"))==null?void 0:q.split(";")[0]){case"text/event-stream":l=Ae(c);break;case"application/json":l=await c.json();break;case"application/octet-stream":l=await c.arrayBuffer();break;case"multipart/form-data":let f=await c.formData();l={},f.forEach((u,h)=>{l[h]=u});break;default:l=await c.text().then(D)}return(c.status>=300||c.status<200)&&(N=new U(c.status,l),l=null),{data:l,error:N,response:c,status:c.status,headers:c.headers}})()}return typeof n=="object"?E(e,t,[...r,Object.values(n)[0]],s):E(e,t,r)}}),Le=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(z.find(r=>e.includes(r))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),E(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),E("http://e.ly",t,[],e));const V="https://suru.wars.studio",A=Le(V,{headers:()=>{const e=j($);if(e)return{Authorization:`Bearer ${e}`}}});class Se extends Error{constructor(r,s){super(s);R(this,"code");this.code=r,this.name="SuruError"}}function L(e){var t;if(e.status!==200||!e.data)throw new Se(e.status,String((t=e.error)==null?void 0:t.value)??"Unknown error");return e.data}function Ue(){const e=new URL(ie("/auth"),globalThis.location.href),t=new URLSearchParams({redirect_to:e.toString()});return`${V}/auth/login?${t}`}async function Ie(){C.set(null),$.set(null)}const Ne=()=>A.user.info.get().then(e=>L(e)),Ee=()=>A.task.list.get().then(e=>L(e)),De=e=>A.task.create.post(e).then(t=>L(t)),je=(e,t)=>A.task.item({id:e}).put(t).then(r=>L(r)),Te=e=>A.task.item({id:e}).patch().then(t=>L(t)),xe=e=>A.task.item({id:e}).delete().then(t=>L(t));async function We(e){if(e===null){C.set(null);return}const t=await Ne();C.set(t),await F()}async function F(e){if(!j(C))return;const t=e??await Ee();w.set(t),ue.set(!1)}const J=e=>j(w).findIndex(t=>t.id===e);async function Je(e,t){const r=J(e);if(r===-1)return;const s=j(w)[r];if(s.done=t,w.update(a=>a.map((i,n)=>n===r?s:i)),console.log({id:e,task:s,tasks:w}),!e.startsWith("new-")){const a=await Te(e);await F(a)}}async function Pe(e,t,r){const s=J(e);if(s===-1)return;const a=j(w)[s];a.text=t,a.done=r,w.update(n=>n.map((d,T)=>T===s?a:d));const i=await je(e,{text:t,done:r});await F(i)}async function qe(e){const t=J(e);if(t===-1)return;w.update(s=>s.filter((a,i)=>i!==t));let r;e.startsWith("new-")||(r=await xe(e)),await F(r)}export{qe as _,Pe as a,De as b,F as c,Je as d,Ie as e,Ue as f,We as g,Re as r,B as s};
